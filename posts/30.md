---
title: デプロイ環境によって変わる処理をコードから環境変数へ
date: '2022-10-24'
---

例えば、タグマネージャのスニペットを本番環境に加えて、その他の環境にもテスト用のものを埋め込みたいような場合があるとします。

過去の私は以下のように実装していました。

```erb
<% if Rails.env.production? %>
  <%# 本番用のスニペット %>
<% else %>
  <%# その他の環境用のスニペット %>
<% end %>
```

うーん。これには問題がありました。

- 👎 本番環境にデプロイするまで if 文の検証ができない
- 👎 `RAILS_ENV=production` で確認できるとしても、そのほかの場所にどんな影響があるかわからない

代わりに、環境変数を利用してみるとどうでしょうか。

```erb
<%= sanitize ENV[:GTM_HEAD_SNIPPET] %>
```

いいかも！
